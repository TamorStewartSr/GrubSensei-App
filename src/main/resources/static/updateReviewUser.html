<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Update User Info</title>
  <link rel="stylesheet" href="styles/addUser.css">
</head>
<body>
  <h2>Update Your Profile</h2>

  <form id="updateForm">
    <label>Display Name (Required):<br />
      <input type="text" id="displayName" required />
    </label><br /><br />

    <label>City:<br />
      <input type="text" id="city" />
    </label><br /><br />

    <label>State:<br />
      <input type="text" id="state" />
    </label><br /><br />

    <label>Zip Code:<br />
      <input type="text" id="zipCode" />
    </label><br /><br />

    <label>Peanut Allergy:<br />
      <input type="checkbox" id="peanutAllergies" />
    </label><br /><br />

    <label>Dairy Allergy:<br />
      <input type="checkbox" id="dairyAllergies" />
    </label><br /><br />

    <label>Egg Allergy:<br />
      <input type="checkbox" id="eggAllergies" />
    </label><br /><br />

    <button type="submit">Update Info</button>
  </form>

  <script>
    const baseUrl = 'http://localhost:8082/reviewUsers'; // Adjust to match your actual API route

    async function updateUser(id, updatedDetails) {
      try {
        const response = await fetch(`${baseUrl}/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(updatedDetails),
        });

        if (!response.ok) {
          const errorData = await response.text();
          throw new Error(`Server responded with status ${response.status}: ${errorData}`);
        }

        alert("User info updated successfully!");
      } catch (error) {
        alert(`Error updating user: ${error.message}`);
      }
    }

    document.getElementById('updateForm').addEventListener('submit', (event) => {
      event.preventDefault();

      const displayName = document.getElementById('displayName').value.trim();

      const updatedDetails = {
        displayName: displayName,
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        zipCode: document.getElementById('zipCode').value.trim(),
        peanutAllergies: !!document.getElementById('peanutAllergies').checked,
        dairyAllergies: !!document.getElementById('dairyAllergies').checked,
        eggAllergies: !!document.getElementById('eggAllergies').checked
      };

      updateUser(displayName, updatedDetails);
    });
  </script>
</body>
</html>
